<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shapes</title>
<script src="js/fabric.js"></script>
<script src="//code.jquery.com/jquery-2.1.0.min.js" type="text/javascript"></script>
</head>
<body>

<table>
<tr>
<td><canvas id="canvas" width="500" height="500" style="border:1px solid #000000"></canvas>
Desired no of Blocks: <input type="text" id="arrayNumber" placeholder="Please enter a number" />
<button onclick="drawGrid()" id="grid_btn">
Create Grid
</button>
</td>
<td><canvas id="canvas1" width="500" height="500" style="border:1px solid #000000"></canvas>
X: <input type="text" id="cursorx" placeholder="Please click on canvas" />Y: <input type="text" id="cursory" placeholder="Please click on canvas" />
<button onclick="addSink()">
Add Sink
</button>
<button onclick="addTable()">
Add Dining Table
</button>
<button onClick="deleteObject()">Delete</button>
</td>
</tr>
</table>
<div style="width:100%;height:100%;position:absolute;vertical-align:middle;text-align:center;">
    <button type="button" style="margin-left:30%;margin-right:auto;display:block;margin-top:2%;margin-bottom:0%">
Synchronize</button> 
</div>â€‹

<script>
var canvas = new fabric.Canvas('canvas');
var canvas1 = new fabric.Canvas('canvas1');
/* var currentCanvasWidth = canvas.width;
var currentcanvasHeight = canvas.height;
var gridSize = 50;

var context = canvas.getContext("2d");  */

/* function drawGrid(gridSize){
	gridSize || (gridSize = 100);
	
	  // Drawing vertical lines
	  var x;
	  for (x = 0; x <= currentCanvasWidth; x += gridSize) {
	      context.moveTo(x + 0.5, 0);
	      context.lineTo(x + 0.5, currentcanvasHeight);
	  }

	  // Drawing horizontal lines
	  var y;
	  for (y = 0; y <= currentcanvasHeight; y += gridSize) {
	      context.moveTo(0, y + 0.5);
	      context.lineTo(currentCanvasWidth, y + 0.5);
	  }

	  gridSize = gridSize;
	  context.strokeStyle = "black";
	  context.stroke();
}    */

function drawGrid(){
	var noOfBlocks = $("#arrayNumber").val();
	var blockHeight = canvas.height/noOfBlocks;
	var blockWidth = canvas.width/noOfBlocks;
	for (var i = 0; i < noOfBlocks; i++) {
	    for (var j = 0; j < noOfBlocks; j++) {
	        var gOptions = {
	            width: blockWidth,
	            height: blockHeight,
	            top: blockHeight * j,
	            left: blockWidth * i,
	            hasControls: false,
	            stroke: '#000000',
	            fill: 'transparent',
	            lockMovementX: true,
	            lockMovementY: true,
	            borderColor: 'transparent',
	        };
	        var rOptions = {
	            width: blockWidth,
	            height: blockHeight,
	            top: blockHeight * j,
	            left: blockWidth * i,
	            //rx: 10,
	            //ry: 10,
	            hasControls: false,
	            stroke: '#000000',
	            fill: 'transparent',
	            lockMovementX: true,
	            lockMovementY: true,
	            borderColor: 'transparent',
	            subType: 'button',
	            id: 'button_' + i + '_' + j
	    };
	        var c = new fabric.Rect(gOptions);
	        var r = new fabric.Rect(rOptions);
	        
	        canvas.add(c);
	        canvas.add(r);
	    }
	}
	$("#grid_btn").disabled = false;
	$("#arrayNumber").attr("disabled", "disabled");
}
 
function addCircle() {
    canvas1.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 }));
    canvas1.selectionColor = 'rgba(0,255,0,0.3)';
    canvas1.selectionBorderColor = 'red';
    canvas1.selectionLineWidth = 5;
}

function addRect() {
	var rect = new fabric.Rect({ width: 100, height: 50, fill: 'green' });
	canvas1.add(rect);
	rect.on('selected', function() {
	  console.log('selected a rectangle');
	}); 
}
	
function addSink() {
    canvas1.add(new fabric.Circle({ radius: 10, fill: '#f55', left: x-500, top: y })); 
}

function addTable() {
	canvas1.add(new fabric.Circle({ radius: 10, fill: '#000', left:x-500, top: y }));
}

function showImageTools (val) {
    if (!$('#imageDialog').length) {
    	$('body').append("<div id='imageDialog' style='position: absolute; top: y; left: x'><h1></h1></div>");
    	$('h1').append(val);
    }
}

function deleteObject() {
    canvas1.getActiveObject().remove();
}

canvas.hoverCursor = 'pointer';
canvas1.hoverCursor = 'pointer';

canvas1.on('mouse:down', function(options){
	$("#cursorx").val(options.e.clientX);
	$("#cursory").val(options.e.clientY);
	x = options.e.clientX;
	y = options.e.clientY;
	});
	
canvas1.on('mouse:move',function(options){
    var pt = { x: options.e.clientX, y: options.e.clientY };
    
    if(options.target!= null) {
    	if(options.target.radius == 10 && options.target.fill == "#f55"){
    		showImageTools ("Sink");
    	}
    	if(options.target.radius == 10 && options.target.fill == "#000"){
    		showImageTools ("Dining Table");
    	}
    	
    }  
});

canvas1.on('mouse:out', function(e) {
     $('#imageDialog').remove();
  });
  
canvas1.on('object:added', function(e) {
    if(e.target!= null) {
    	if(e.target.radius == 10 && e.target.fill == "#f55"){
    		console.log("Sink created");
    	}
    	if(e.target.radius == 10 && e.target.fill == "#000"){
    		console.log("Dining Table created");
    	}
    } 
 });
 
canvas1.on('object:removed', function(e) {
    if(e.target!= null) {
    	if(e.target.radius == 10 && e.target.fill == "#f55"){
    		console.log("Sink deleted");
    	}
    	if(e.target.radius == 10 && e.target.fill == "#000"){
    		console.log("Dining Table deleted");
    	}
    } 
 });
 
canvas1.on('object:moving', function(e) {
    console.log("object moved to Y: " + e.e.clientY);
 });

canvas.on('mouse:down', function (e) {
        if (e.target.get('subType') == 'button') {
        	
            console.log('button ' + e.target.id + ' was clicked');
            var currentColor = e.target.fill;
             
            e.target.setFill("#cc0000");
            switch (currentColor) {
            case 'transparent':
              e.target.setFill("#000");
              break;
            case '#000':
              e.target.setFill("#cc0000");
              break;
            case '#cc0000':
                e.target.setFill("#ffff00");
                break;
            case '#ffff00':
                e.target.setFill("#008000");
                break;
            case '#008000':
              e.target.setFill("transparent");
              break;
          }
            canvas.renderAll();
        }
});

canvas1.renderAll();

</script>

</body>
</html>